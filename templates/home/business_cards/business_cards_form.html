{% load static %}
{% include 'home/base.html' %}
<body>
{% include 'home/side_nav_bar.html' %}
{% include 'home/register.html' %}

 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>


<link rel="stylesheet" href="{% static 'css/business_cards/form.css' %}">
<script>
    $(document).ready(function(){
  $(".flip").click(function(){
   if ($(this).find($(".panel")).is(":hidden")) {
       $("i").removeClass("fa-angle-up").addClass("fa-angle-down");
       $(".panel").slideUp();
       $(this).find($(".panel")).slideToggle("slow");
       $("i", this).removeClass("fa-angle-down").addClass("fa-angle-up");
   }

  });
  $(".title_header").click(function(){

   $("i").removeClass("fa-angle-up").addClass("fa-angle-down");
       $(".panel").slideUp();
  });
});
</script>
<style>
    .form-row{
        margin: 2%;
    }
    .flip{
        margin-top: 2%;
        min-height: 50px;
    }
    .title_header{
        color: #ffffff;
        min-height: 20px;
        font-size: 18px;
    }
    .fa-angle-down, .fa-angle-up{
        font-size: 30px;
    }
    html{
        scroll-behavior: smooth;
    }

    #loader {
        position: absolute;
        left: 50%;
        top: 50%;
        z-index: 1;
        width: 120px;
        height: 120px;
        margin: -76px 0 0 -76px;
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        display: none;
    }

    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Add animation to "page content" */
    .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
        from { bottom:-100px; opacity:0 }
        to { bottom:0px; opacity:1 }
    }

    @keyframes animatebottom {
        from{ bottom:-100px; opacity:0 }
        to{ bottom:0; opacity:1 }
    }
    #myBtn {
    {#display: none;#}
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 99;
        font-size: 18px;
        border: none;
        outline: none;

        color: white;
        cursor: pointer;
        padding: 15px;
        border-radius: 50%;
    }

    #myBtn:hover {
        background-color: #555;
    }
    .btn-primary{
        margin-top: 10px;
    }

    #iframe {
        width: 400px;
        height: 250px;
        border: 0px;
        margin-left: 15px;
    }
    @media screen and (-webkit-min-device-pixel-ratio:0) {
        #iframe {
            zoom: 1;
        }
    }
    #iframe {
        -moz-transform: scale(0.75);
        -moz-transform-origin: 0 0;
        -o-transform: scale(0.75);
        -o-transform-origin: 0 0;
        -webkit-transform: scale(0.75);
        -webkit-transform-origin: 0 0;
        border: #1e2229 1px solid;
    }
    @media only screen and (max-width: 870px) {
        #iframe {
            margin-left: -24px;

            -moz-transform: scale(0.75);
            -moz-transform-origin: 0 0;
            -o-transform: scale(0.75);
            -o-transform-origin: 0 0;
            -webkit-transform: scale(0.75);
            -webkit-transform-origin: 0 0;
        }
        .col-md-12{
        padding-left: 0 !important;
            padding-right: 0 !important;
        }
        .img-responsive{
            height: 100% !important;
            width: 100% !important;
        }

    }
    select.form-control:not([size]):not([multiple]) {
        height: unset !important;
    }
    #footer_images{
        position: fixed;
        left: 5%;
        right: 5%;
        bottom: 0;
        width: 90%;
        color: white;
        {#background-color: darkgrey;#}
        text-align: center;
    }
    .carousel-control{
        width: unset !important;
    }
</style>
<form class="needs-validation" id="{% if business_card_id != "" or business_card_id != none %}{{ business_card_id }}{% else %}-1{% endif %}" style="width: 100%"   enctype="multipart/form-data" novalidate>
   <div class="" style="background:#6c7b88;border-style:solid ;box-shadow: #464a52 ;border-radius: 12px; text-underline: #1e2229;font-weight: bold">
       {% csrf_token %}
       <div class="title_header" id="" style="background: #6c7b88;margin: auto;margin-left: 2%;"><b id="input_box_header1">{{ labels.business }} {{ labels.cards }}</b>
{#           <i class="fa fa-angle-down" style="float:right;margin-right: 4%;"></i>#}
       </div>

       <div class="" style="background: #ffffff;" >
                <div class="form-row" >
                    <div class="col-md-4 mb-3">
                        <label for="validationCustom04" id="l_business_card_language">{% if all_languages|length > 1 %}Choose Language{% endif %}</label>
                        <select  id="business_card_language" class="form-control">
                            {% for language in all_languages %}
                                <option value="{{ language.id }}">{{ language.language }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
              <div class="form-row">
                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_company_name">{{ labels.company_name }}</label>
                  <input type="text" class="form-control" id="company_name" placeholder="{{ labels.company_name }}" value="{{ details.company_name }}"  >
                </div>

                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_company_tagline">{{ labels.company }} {{ labels.tagline }}</label>
                  <input type="text" class="form-control" id="company_tagline" placeholder="{{ labels.company_tagline }}" value="{{ details.company_tagline}}"  >
                </div>

                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_founder">{{ labels.founder }}</label>
                      <input type="text" class="form-control" id="founder" placeholder="{{ labels.founder }}" value="{{ details.founder }}"  >
                  </div>

                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_established_date">{{ labels.established }}</label>
                      <input type="text" class="form-control" id="established_date" placeholder="{{ labels.established}}" value="{{ details.established_date }}"  >
                  </div>

                <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_ceo">{{ labels.ceo }}</label>
                      <input type="text" class="form-control" id="ceo" placeholder="{{ labels.ceo }}" value="{{ details.ceo }}" >
                </div>
                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_email">{{ labels.email }}</label>
                      <input type="text" class="form-control" id="email" placeholder="{{ labels.email }}" value="{{ details.email }}"  >
                  </div>
                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_social_id">{{ labels.social_id }}1</label>
                      <input type="text" class="form-control" id="social_id1" placeholder="{{ labels.social_id }}1" value="{{ details.social_id1 }}"  >
                  </div>

                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_social_id2">{{ labels.social_id }}2</label>
                  <input type="text" class="form-control" id="social_id2" placeholder="{{ labels.social_id}}2"  value="{{ details.social_id2 }}" >
                </div>

                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_website">{{ labels.website}}</label>
                  <input type="text" class="form-control" id="website" placeholder="{{ labels.website}}" value="{{ details.website}}"  >
                </div>

                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_address">{{ labels.address }}</label>
                  <input type="text" class="form-control" id="address" placeholder="{{ labels.address }}" value="{{ details.address}}" >
                </div>

                <div class="col-md-4 mb-3">
                  <label for="validationCustom04" id="l_contact">{{ labels.contact }}</label>
                  <input type="text" class="form-control" id="contact" placeholder="{{ labels.contact }}" value="{{ details.contact }}" >
                </div>

                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_telephone">{{ labels.telephone }}</label>
                      <input type="text" class="form-control" id="telephone" placeholder="{{ labels.telephone }}" value="{{ details.telephone }}" >
                  </div>
                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_qrcode">{{ labels.qrcode }} {{ labels.text }}</label>
                      <input type="text" class="form-control" id="qrcode" placeholder="{{ labels.website }} , {{ labels.upi }}, {{ labels.or }}, {{ labels.number }}" value="{{ details.qrcode }}" >
                  </div>

                  <div class="col-md-4 mb-3">
                      <label for="validationCustom04" id="l_logo">{{ labels.logo }}</label>
                      <input id="logo" name="photo" type="file" accept="image/*" placeholder="{{ labels.logo }}" onchange="document.getElementById('uploaded_logo').src = window.URL.createObjectURL(this.files[0])">
                      <img src="/media/{{ details.logo }}" id="uploaded_logo" width="40px" >
                  </div>

              </div>
       </div>
   </div>

{#    <button class="btn btn-primary" id="submit_form" >Submit form</button>#}
</form>


<div class="row">
    <div class="col-md-12" id="payment_btn" style="display: block;margin-top: 10px">
        <button onclick="if ($('form').attr('id')){window.location='/bussiness_cards/business_card_image/?business_card_id=' + $('form').attr('id')} else {alert('create resume first')}" type="button" class="btn btn-primary" onclick="paynow()">Download Card</button>
        <button onclick="if ($('form').attr('id')){window.location='/bussiness_cards/get_wk_pdf/?content_type=download&business_card_id=' + $('form').attr('id')} else {alert('create resume first')}" type="button" class="btn btn-primary" onclick="paynow()">Download PDF</button>
    </div>
</div>

{#<div id="footer_images">#}
{#    <div class="flip-card" id="{{ template_id }}">#}
{#      <div class="flip-card-inner"style="width: 50px;height: 50px">#}
{#          {% for business_card in business_template %}#}
{##}
{#              <div class="flip-card-front"  id="{{ business_card.id }}"style="{% if business_card.id|stringformat:"i" == template_id %}border-style: solid;{% else %}border-style: none;{% endif %}margin-bottom: 5px;height: 50px;width: 50px;"align="center">#}
{#                <img id="{{ business_card.id }}" src="/media/{{ business_card.template_image_business_icon }}" alt="Avatar" style="width:90%;height:100%;margin: 2%;">#}
{#              </div>#}
{#          {% endfor %}#}
{#      </div>#}
{#    </div>#}
{#</div>#}


<div id="iframe_div" style="margin-top:40px;overflow-scrolling: touch">
    Output PDF Pages
    <div id="wrap">
        <iframe id="iframe" src="" ></iframe>
    </div>
</div>

{#<label id="myBtn" title="Go to top"><i class="fa fa-angle-up"></i>Top</label>#}
<div id="loader"></div>
 </div>
    </div>

  </main>
  <!-- page-content" -->
</div>

<div id="footer_images">
    <div>
        <button class="btn btn-primary" id="submit_form" style="float: left;margin-right:15px;color: #ffffff;background: #6c7b88"> Submit</button>
        <button style="float: right;margin-left: 15px;color: #ffffff;background: #6c7b88;"  class="btn btn-primary">Top</button>

    </div>
    <div class="row" style="margin-top: 10px"><br>
        <div class="col-md-12">

            <div class="carousel slide multi-item-carousel" id="theCarousel">
                <div class="carousel-inner" id="{{ template_id }}" >
                    {% for business_card in business_template %}

                        {% if forloop.counter < 4 %}
                            {% cycle '<div class="item active">' '' '' %}
                        {% else %}
                            {% cycle '<div class="item">' '' '' %}
                        {% endif %}

                        <div class="col-xs-4">
                            <div style="color: black;{% if business_card.id == template_id %}border-style: solid;{% else %}border-style: none;{% endif %}margin-bottom: 5px;"align="center" class="flip-card-front"  href="#1" id="{{ business_card.id }}">
                                <img id="{{ business_card.id }}" src="/media/{{ business_card.template_image_business_icon }}" alt="Avatar" style="margin: 2%;" class="img-responsive">
                            </div>
                        </div>
                        {% cycle '' '' '</div>' %}

                    {% endfor %}

                    <!--  Example item end -->
                </div>
                <a class="left carousel-control" href="#theCarousel" data-slide="prev"><i class="glyphicon glyphicon-chevron-left"></i></a>
                <a class="right carousel-control" href="#theCarousel" data-slide="next"><i class="glyphicon glyphicon-chevron-right"></i></a>
            </div>
        </div>
    </div>
</div>
<div style="height: 500px">&nbsp;</div>
<script>

    {% if business_card_id != "" or business_card_id != none %}
        $('form').attr("id",{{ business_card_id }});
    {% else %}
    {% endif %}
    var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    var today  = new Date();
    console.log(today.toLocaleDateString("hi-IN", options));
    var template_id = '{{ template_id }}';
    console.log(template_id);
    var create_business_card_url = '{% url "business_cards:CreateBusinessCard" %}';



    $("#submit_form").click(function (event) {
        event.preventDefault();
    var data = new FormData();
    var template_id = $(".carousel-inner")[0].id;
    console.log('template_id'+template_id)

    {#data.append('files[]', $('#image').prop('files')[0]);#}
    {#console.log($('#image').prop('files')[0]);#}
    var company_name_length = $("#ceo").val().length;
    var founder_length = $("#ceo").val().length;
    var social_id2 = $("#social_id2").val();
    console.log(social_id2);
    var address = $("#address").val();
    var website = $("#website").val().length;
    console.log(company_name_length);
   {##}
   {#if (company_name_length < 2 ) {#}
   {#     alert("Groom Name required with atleast 3 characters");#}
   {# }#}
   {#else if ( founder_length < 2 ){#}
   {#    alert("Bride Name required with atleast 3 characters");#}
   {#}#}
   {# else if ( social_id2 == "" ){#}
   {#        alert("Date of Business required with atleast 3 characters");#}
   {#    }#}
   {# else if ( address == "" ){#}
   {#        alert("Time of Business required with atleast 3 characters");#}
   {#    }#}
   {# else if ( website < 2 ){#}
   {#        alert("Place of Business required with atleast 3 characters");#}
   {#    }#}
   {# else {#}
        $("#loader").css('display','block');

        formdata = new FormData();
        formdata.append('business_card_id', $('form').attr('id'));
        formdata.append('template_id', template_id);
        {#formdata.append('image', $('#image').prop('files')[0]);#}
        {#formdata.append('groom_or_bride', $('#groom_or_bride').val());#}
        formdata.append('ceo', $('#ceo').val());
        formdata.append('company_name', $('#company_name').val());
        formdata.append('company_tagline', $('#company_tagline').val());
        formdata.append('social_id1', $('#social_id1').val());
        formdata.append('social_id2', $('#social_id2').val());
        formdata.append('address', $('#address').val());
        formdata.append('website', $('#website').val());
        formdata.append('email', $('#email').val());
        formdata.append('social_id', $('#social_id').val());
        formdata.append('founder', $('#founder').val());
        formdata.append('established_date', $('#established_date').val());
        formdata.append('contact', $('#contact').val());
        formdata.append('telephone', $('#telephone').val());
        formdata.append('qrcode', $('#qrcode').val());
        formdata.append('person_name', $('#person_name').val());
        formdata.append('logo', $('#logo').prop('files')[0]);
        {#formdata.append('logo', $('#logo').prop('files')[0]);#}
       console.log('ksksksk');
       {#formdata.append('language', $('#language').val());#}
        formdata.append('language_id', $('#business_card_language').val());
        formdata.append('csrfmiddlewaretoken', '{{csrf_token}}');
        jQuery.ajax({
            url: create_business_card_url,
            type: "POST",
            data: formdata,
            processData: false,
            contentType: false,
            success: function (data) {
                $("#iframe_div").css('display','block');
                $('form').attr("id",data['business_card_id']);
                var $iframe = $('#iframe');
                $iframe.attr('srcdoc', data['html']);
                $("#loader").css('display','none');
                $('html, body').animate({
                    scrollTop: $("#iframe_div").offset().top
                }, );
            }
        });
    {#}#}
    });

    $(document).ready(function() {
        $(".flip-card-front").click(function () {
            if ($(this).css("border-style") == "none") {
                $(".flip-card-front").css('border-style','none')
                console.log($(this).css("border-style"));
                var template_id = this.id;
                {#console.log(this.id);#}
                $(this).css('border-style','solid')
                {#$(".flip-card").attr('id',template_id);#}
                $(".carousel-inner").attr('id',template_id)
                event.preventDefault();
                {#var template_id = $(".flip-card")[0].id;#}
                var data = new FormData();
                {#data.append('files[]', $('#image').prop('files')[0]);#}
                {#console.log($('#image').prop('files')[0]);#}
                var company_name_length = $("#company_name").val().length;
                console.log(company_name_length);

                if (company_name_length < 2 ) {
                    alert("Company Name required with atleast 3 characters");
                }
                else {
                    $("#loader").css('display','block');

                    formdata = new FormData();
                    formdata.append('business_card_id', $('form').attr('id'));
                    formdata.append('template_id', template_id);
                    {#formdata.append('image', $('#image').prop('files')[0]);#}

                    formdata.append('ceo', $('#ceo').val());
                    formdata.append('company_name', $('#company_name').val());
                    formdata.append('company_tagline', $('#company_tagline').val());
                    formdata.append('social_id1', $('#social_id1').val());
                    formdata.append('social_id2', $('#social_id2').val());
                    formdata.append('address', $('#address').val());
                    formdata.append('website', $('#website').val());
                    formdata.append('email', $('#email').val());
                    formdata.append('social_id', $('#social_id').val());
                    formdata.append('founder', $('#founder').val());
                    formdata.append('established_date', $('#established_date').val());
                    formdata.append('contact', $('#contact').val());
                    formdata.append('address', $('#address').val());
                    formdata.append('telephone', $('#telephone').val());
                    formdata.append('qrcode', $('#qrcode').val());
                    formdata.append('person_name', $('#person_name').val());
                    formdata.append('logo', $('#logo').prop('files')[0]);



                    formdata.append('language_id', $('#business_card_language').val());
                    formdata.append('csrfmiddlewaretoken', '{{csrf_token}}');
                    jQuery.ajax({
                        url: create_business_card_url,
                        type: "POST",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            $("#iframe_div").css('display','block');
                            $('form').attr("id",data['business_card_id']);
                            var $iframe = $('#iframe');
                            $iframe.attr('srcdoc', data['html']);
                            $("#loader").css('display','none');
                            $('html, body').animate({
                                scrollTop: $("#iframe_div").offset().top
                            }, );
                        }
                    });
                }
            }
        });
    });
        $("#myBtn").click(function (){
            $('html, body').animate({
        scrollTop: $(".needs-validation").offset().top
    });

    },);



</script>

<script>



$('#business_card_language').change(function(event) {
    event.preventDefault();
    $.ajax({
        type:"POST",
        url : "{% url 'business_cards:selected_language' %}",
        data : {'business_language_id':$(this).val(),
            'csrfmiddlewaretoken':'{{ csrf_token }}'},
        success : function(response) {
            data = response;
            console.log('data:'+data);
            var label = data['labels']
            var label = JSON.parse(label);
            console.log('label:',label);
            console.log("ceo:"+label['groom']+'/'+label['bride']);

            $("#l_ceo").html(label["ceo"]);

            $("#l_company_name").html(label["company_name"]);
            $("#l_company_tagline").html(label["l_company_tagline"]);
            $("#l_social_id2").html(label['social_id2']);
            $("#l_address").html(label['address']);
            $("#l_website").html(label['website']);
            $("#l_founder").html(label['founder']);
            $("#l_established_date").html(label['established_date']);
            $("#l_email").html(label['email']);
            $("#l_social_id").html(label['social_id']);
            $("#l_social_id2").html(label['social_id']+'2');
            $("#l_contact").html(label['contact']);
            $("#l_person_name").html(label['person_name']);
            $("#l_established_date").html(label['established']);
            $("#l_telephone").html(label['telephone']);
            $("#l_qrcode").html(label['qrcode']);
            $("#l_language").html(label['language']);

            {#console.log(data);#}
        },
        error: function() {
            alert('Error occured');
        }
    });
    });

// Instantiate the Bootstrap carousel
$('.multi-item-carousel').carousel({
    interval: false
});

// for every slide in carousel, copy the next slide's item in the slide.
// Do the same for the next, next item.

</script>

</body>
</html>