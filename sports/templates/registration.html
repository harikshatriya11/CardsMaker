{% load static %}
{% include 'base.html' %}
{#  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">#}
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
<link rel="stylesheet" href="{% static 'css/loader.css' %}" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
{#  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>#}
{#  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>#}
<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
<script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>

{#<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">#}
{#<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>#}
{#<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>#}
<script>
    function onloadCallback() {
        /* Place your recaptcha rendering code here */
    }
</script>


<!-- Trigger the modal with a button -->

<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">

                <h4 class="modal-title">Register/Login</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            {#            <div class="modal-body">#}
            {#                <div class="container">#}
            {#                    <ul class="nav nav-pills" style="color: white">#}
            {#                        <li class="active" style="text-align:center;color:white;background: #5b80b2;margin: 5px;border-radius: 5px"><a data-toggle="pill" href="#login" style="color:white !important;margin: 10px" > Login </a></li>#}
            {#                        <li style="text-align:center;background: #5b80b2;margin: 5px;border-radius: 5px"><a data-toggle="pill" href="#register" style="color:white !important;margin: 10px"> Register </a></li>#}
            {#                    </ul>#}
            {#                    <div class="tab-content">#}
            {#                        <div id="login" class="tab-pane fade in active show">#}
            {#                            <h3>Login</h3>#}
            {#                            <label>UserName</label><br>#}
            {#                            <input value="" id="login_username"type="text" placeholder="Enter UserName"><br>#}
            {#                            <div id="invalid_username_l"></div><br>#}
            {#                            <label>Password</label><br>#}
            {#                            <input value="" id="login_password" type="password" placeholder="Enter  Password"><br>#}
            {#                            <div id="invalid_password_l"></div>#}
            {#                            <br>#}
            {#                            <button class="btn-primary" id="submit_login" onclick="login_function()" >Submit</button>#}
            {#                        </div>#}
            {#                        <div id="register" class="tab-pane fade">#}
            {#                            <h3>Register</h3>#}
            {#                            <label>UserName</label><br>#}
            {#                            <input minlength="4" value="" id="register_username" type="text" placeholder="Enter UserName"><br>#}
            {#                            <div id="invalid_username_r"></div><br>#}
            {#                            <label>Mobile number</label><br>#}
            {#                            <input value="" id="register_mobile" type="number" minlength="6000000000" maxlength="9999999999" placeholder="Enter UserName"><br>#}
            {#                            <br>#}
            {#                            <label>Password (must be 8 char)</label><br>#}
            {#                            <input value="" id="register_password" type="password" placeholder="Enter unique UserName">#}
            {#                            <div id="invalid_password_r"></div><br>#}
            {#                            <br>#}
            {#                            <button class="btn-primary" id="submit_userdetails" onclick="register()" >Submit</button>#}
            {#                        </div>#}
            {#                    </div>#}
            {#                </div>#}
            {#            </div>#}



            {#                    <div class="modal-body">#}
            {#                      <p id="label_mobile"></p>#}
            {#                            <div id="div_mobile">#}
            {#                                <select style="width: 20%" id="dialcode">#}
            {##}
            {#                                    <option value="91">India (+91)</option>#}
            {#                                  {% for a in country %}#}
            {#                                     <br>#}
            {#                                      <option value="{{ a.phone }}">{{ a }} (+{{ a.phone }})</option>#}
            {#                                  {% endfor %}#}
            {#                                </select>#}
            {#                                <input value="" type="number" id="mobile_number"  required> Mobile Number#}
            {#                                <div id="checkdiv" style="color: red"></div>#}
            {#                            </div>#}
            {#                            <div id="div_otp" style="display: none; margin-top: 2%" required>#}
            {#                                <input value="" type="text" id="mobile_otp">   Enter OTP#}
            {#                                <div id="otp_checkdiv" style="color: red"></div>#}
            {#                            </div>#}
            {#                    </div>#}
            {#                    <div class="modal-footer">#}
            {#                         <div class="loader" style="display: none;"></div>#}
            {#                      <button type="button" id="submit_mobile" class="btn btn-default" >Submit</button>#}
            {#                      <button type="button" id="submit_otp" class="btn btn-default"  style="display: none">Submit OTP</button>#}
            {#                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>#}
            {#                    </div>#}
        </div>
    </div>
</div>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>

</div>

<body>
<!------ Include the above in your HEAD tag ---------->

<div class="container">
    <div class="row centered-form">
        <div class="col-xs-12 col-sm-8 col-md-4 col-sm-offset-2 col-md-offset-4">
            <div class="panel panel-default">
                <div class="panel-heading" style="display: inline-flex;width: 100%">
                    <div style="float:left;width: 50%"><h3 class="panel-title" >Register</h3></div>
                    <a href="/sports/tbt/login/" style="float:right;text-align: right;width: 50%;text-align: -webkit-center;" type="button"  class="btn btn-default" >Login</a>
                </div>
                <div class="panel-body">
                    <form role="form">

                        <div id="div_mobile">
                            <div class="form-group">
                                <select type="text" name="dialcode" id="dialcode" class="form-control input-sm" placeholder="Email Address">
                                    <option value="91">India (+91)</option>
                                    {% for a in country %}
                                        <option value="{{ a.phone }}">{{ a }} +({{ a.phone }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="number" name="mobile_number" id="mobile_number" class="form-control input-sm" placeholder="Mobile Number">
                            </div>
                            <div class="form-group">
                                <input type="password" name="password" id="password" class="form-control input-sm" placeholder="Password">
                            </div>
                            <div id="checkdiv" style="color: red"></div>
                        </div>

                        <div id="div_otp" style="display: none; margin-top: 2%" required>
                            <input value="" type="text" id="mobile_otp">   Enter OTP
                            <div id="otp_checkdiv" style="color: red"></div>
                        </div>

                        {#                        <input value="Register" class="btn btn-info btn-block">#}
                        <div class="modal-footer">
                            <div class="loader" style="display: none;"></div>
                            <a href="/sports/tbt/otp_login/" style="padding:4px;border-radius: 5px;background: #e0f7e0">OTP Login</a><br><br>
                            <button type="button" id="submit_mobile" class="btn btn-default" style="width: 100%;background: lightblue">Submit</button>
                            <button type="button" id="submit_otp" class="btn btn-default"  style="display: none;width: 100%;background: lightblue">Submit OTP</button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<style>
    .loader {
        border: 16px solid #f3f3f3;
        border-radius: 50%;
        border-top: 16px solid #3498db;
        width: 20px;
        height: 20px;
        -webkit-animation: spin 2s linear infinite; /* Safari */
        animation: spin 2s linear infinite;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .modal-body input {

        width: 100%;
    }
</style>
{##}
{#<style>#}
{#    .modal {#}
{#        top: 20% !important;#}
{#        display: block !important;#}
{#    }#}
{#    .modal-dialog{#}
{#        width: fit-content !important;#}
{#    }#}
{##}
{#</style>#}


<script>
    var firebaseConfig = {
        apiKey: "AIzaSyC7Dw_cb5GyYQHhJlP2LRpw0gKQUIbTwy4",
        authDomain: "cardmaker-fe054.firebaseapp.com",
        databaseURL: "https://cardmaker-fe054.firebaseio.com",
        projectId: "cardmaker-fe054",
        storageBucket: "cardmaker-fe054.appspot.com",
        messagingSenderId: "1087015971680",
        appId: "1:1087015971680:web:5f965eb0b8b7122e9b4c05",
        measurementId: "G-B78P1JBLW2"
    };

    if (!firebase.apps.length) {
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log(firebase.auth ());
        firebase.analytics();
    }
    firebase.auth().useDeviceLanguage();
    console.log(firebase);


    $(function () {
        $('#submit_mobile').on('click', function () {
            var passowrd = document.getElementById('password').value;
            var mobile_number = document.getElementById("mobile_number");
            var dialcode = '+'+document.getElementById("dialcode").value;

            console.log(dialcode);
            var phoneno = /^\d{10}$/;
            if (dialcode === 'nil') {
                console.log('d');
                document.getElementById("checkdiv").innerHTML = "Please select Your Country";
            }
            else if (passowrd.length < 8 ){
                document.getElementById("checkdiv").innerHTML = "Please Enter PASSWORD 8 or more than 8 Character";

            }
            else if(!mobile_number.checkValidity() )  {
                console.log('dm');
                document.getElementById("checkdiv").innerHTML = mobile_number.validationMessage;

            }
            else if(mobile_number.value.match(phoneno))
            {
                var mobile_no = document.getElementById("mobile_number").value;
                $(".loader").css('display','block');


                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('mobile_number', {
                    'size': 'invisible',
                    'callback': function(response) {
                        // reCAPTCHA solved, allow signInWithPhoneNumber.
                        grecaptcha.reset(window.recaptchaWidgetId);
                        onSignInSubmit();
                    }
                });
                var phoneNumber = dialcode+document.getElementById("mobile_number").value;
                {#alert(phoneNumber);#}
                console.log(phoneNumber);
                var appVerifier = window.recaptchaVerifier;
                console.log(appVerifier);

                firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                    .then(function (confirmationResult) {

                        // SMS sent. Prompt user to type the code from the message, then sign the
                        console.log('code sent');
                        console.log(confirmationResult);
                        $("#div_mobile").css('display','none');
                        $("#label_mobile").css('display','none');
                        $("#div_otp").css('display','block');
                        $("#submit_mobile").css('display','none');
                        $("#submit_otp").css('display','block');
                        // user in with confirmationResult.confirm(code).
                        window.confirmationResult = confirmationResult;
                        $(".loader").css('display','none');
                    }).catch(function (error) {
                    $(".loader").css('display','none');
                    // Error; SMS not sent
                    document.getElementById("checkdiv").innerHTML = "Code not sent please check Number or Try again after sometime";

                    console.log('code not sent');
                    console.log(error);
                });
                $("#checkdiv").empty();




                {#$('#apndloader').append('<div class="loader"></div>');#}

                var user = "{{user}}";
                let mobile_number  = document.getElementById('mobile_number').value;
                let csrftoken = "{{ csrf_token }}";

                // var Status = $(this).val();

            }
            else{
                document.getElementById("checkdiv").innerHTML = "Please enter correct mobile number";
            }

        });
    });

    $(function () {
        $('#submit_otp').on('click', function () {
            $("#otp_checkdiv").html("");
            var code = document.getElementById('mobile_otp').value;
            var dialcode = document.getElementById("dialcode").value;
            var mobile_number = document.getElementById('mobile_number').value;
            var password = document.getElementById('password').value;
            {#alert(code);#}
            if (code === '' )
            {
                {#alert('not submitted');#}
                $("#otp_checkdiv").html("Please Enter correct OTP number");
            }
            else {
                $("#otp_checkdiv").html("");
                $(".loader").css('display','block');
                confirmationResult.confirm(code).then(function (result) {
                    // User signed in successfully.
                    $(".loader").css('display', 'none');

                    var user = result.user;

                    var data = {'mobile_number': mobile_number, 'code': code}
                    var status = 200;

                    $.post("{{ request.url }}/sports/tbt/registration/",
                        {
                            'mobile_number': mobile_number,
                            'code': code,
                            'dialcode': dialcode,
                            'password': password,
                            'csrfmiddlewaretoken':'{{ csrf_token }}',
                            'firebase_uid':JSON.stringify(user.uid),
                        },
                        function (data) {
                            {#alert("Data: " + data );#}
                            if (data['status'] == 200){window.location = "/";}
                            if (data['status'] == 201){$("#otp_checkdiv").html(data['msg']);}
                            if (data['status'] == 202){$("#otp_checkdiv").html(data['msg']);}
                            else {$("#otp_checkdiv").html("Unable to register");}


                        });
                    console.log('hello');

                }).catch(function (error) {
                    $(".loader").css('display', 'none');
                    $("#otp_checkdiv").html("Please Enter correct OTP number");
                    {#document.getElementById("checkdiv").innerHTML = "Please Enter correct OTP";#}
                });
            }
        });
    });

</script>